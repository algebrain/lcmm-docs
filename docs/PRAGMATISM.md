# PRAGMATISM: как принимать технические решения в LCMM

Версия: `1.0-draft`

## 1. Зачем нужен этот документ

Этот документ нужен, чтобы проект не застревал в преждевременной сложности.

Основной принцип:
1. сначала доводим до рабочего состояния живое приложение;
2. затем улучшаем по фактическим проблемам;
3. не внедряем сложные решения "на всякий случай".

## 2. Что считаем успехом

Успех на раннем этапе:
1. приложение стабильно работает;
2. ключевые пользовательские сценарии выполняются;
3. проект можно поддерживать без постоянных аварийных ручных действий.

## 3. Базовые правила

1. Простота на старте это инженерное решение, а не временный компромисс.
2. Надежность важнее модности технологий.
3. Любое усложнение должно решать уже наблюдаемую проблему.
4. Если проблема не измерена, усложнение не принимается.
5. Сначала реализуем минимально достаточное решение, потом расширяем.

## 4. Красные линии для первого рабочего релиза

До появления подтвержденной необходимости не делаем:
1. сложную инфраструктуру развертывания;
2. распределенную архитектуру вместо монолита;
3. усложненную авторизацию при достаточности сессионного app-level middleware;
4. дополнительные подсистемы, которые не решают текущую измеримую проблему.

## 5. Когда усложнение допустимо

Усложнение допустимо только если одновременно:
1. проблема повторяется, а не является разовым сбоем;
2. проблема подтверждается логами/метриками/инцидентами;
3. более простой вариант не устраняет проблему;
4. у команды есть ресурс поддерживать новое решение.

## 6. Стартовый минимум LCMM

### 6.1 Обязательно на первом рабочем релизе

1. `ARCH.md`: зафиксировать архитектурную рамку (модули, слабая связность, событийный обмен).
2. `MODULE.md`: собрать модуль по единым правилам структуры и зависимостей.
3. `CONFIGURE.md` и `CONFIGURE_ADMIN.md`: настроить предсказуемый запуск и конфигурацию.
4. `ROUTER.md`: поднять базовый HTTP-слой маршрутов.
5. `SECURITY.md`: подключить app-level сессионный auth middleware, redaction и безопасные error-response.
6. `CONTRACT.md`: описать контракты модулей, чтобы границы были явны человеку и ИИ-агенту.
7. `DATABASE.md`: работать с БД через цикл `backup -> migratus migrate -> migratus status -> start api`.
8. `LOGGING.md`: включить структурированные логи, достаточные для диагностики инцидентов.
9. `BUS.md`: подключить событийную шину, если модуль действительно строится на событиях.
10. `HYDRATION.md`: для межмодульных данных включить anti-storm минимум (`negative cache` + `request collapse`).
11. `TRANSACT.md`: включать только если модулю реально нужен транзакционный режим шины.

### 6.2 Можно добавить позже (по факту необходимости)

1. Расширенные схемы безопасности сверх базового сессионного подхода.
2. Усложненные схемы гидрации, если базовый anti-storm уже не покрывает нагрузку.
3. Расширение HTTP-слоя и отдельный `HTTP.md`, если это реально нужно текущему приложению.
4. Продвинутые процессы (`SAGA.md`) для длинных и сложных бизнес-процессов.

## 7. Практические сценарии

### 7.1 Первый релиз

Делаем:
1. рабочие endpoint-ы;
2. стабильную БД и миграции;
3. минимальную безопасность;
4. базовые логи и диагностику.

Не делаем:
1. архитектуру "с запасом на большие нагрузки", если текущая нагрузка этого не требует.

### 7.2 Рост нагрузки

Если под реальной нагрузкой появляются повторяющиеся timeout/ошибки:
1. фиксируем проблему метриками;
2. выбираем минимальное изменение, которое убирает проблему;
3. проверяем результат после внедрения.

### 7.3 Рост команды

Если увеличивается число разработчиков и модулей:
1. усиливаем правила и автоматизацию только там, где уже есть системные потери времени;
2. не вводим процессы, которые не уменьшают реальные потери.

## 8. Анти-паттерны

1. "Сначала идеальная платформа, потом продукт".
2. "Сложное решение без измеренной проблемы".
3. "Новые технологии вместо устранения причины сбоя".
4. "Решение дороже в поддержке, чем сама проблема".

## 9. Чек-лист перед добавлением сложности

Перед принятием сложного решения ответьте "да" на все пункты:
1. Проблема повторяется?
2. Проблема подтверждена данными?
3. Простой вариант уже проверен и недостаточен?
4. Есть понятный план внедрения и отката?
5. Есть ресурс сопровождать решение после внедрения?

Если хотя бы один ответ "нет", решение откладывается.

## 10. Связь с другими документами

Этот документ задает рамку принятия решений, а конкретные правила реализуются в профильных документах.

1. [ARCH](./ARCH.md)  
Архитектурная база LCMM. Любое решение в `PRAGMATISM.md` должно быть совместимо с архитектурными принципами из `ARCH.md`.

2. [MODULE](./MODULE.md)  
Правила проектирования модуля. Используется, чтобы прагматичные решения превращались в стабильную структуру модуля.

3. [CONTRACT](./CONTRACT.md)  
Спецификация контрактов модулей. Нужен, чтобы упрощения/ограничения были явно зафиксированы и понятны ИИ-агентам.

4. [BUS](./BUS.md) и [TRANSACT](./TRANSACT.md)  
Правила событийной шины и транзакционного режима. Нужны для практичной надежности без переусложнения.

5. [ROUTER](./ROUTER.md)  
Правила HTTP-маршрутизации. Нужен для единообразной интеграции middleware и API.

6. [CONFIGURE](./CONFIGURE.md) и [CONFIGURE_ADMIN](./CONFIGURE_ADMIN.md)  
Правила конфигурации для разработчика и администратора. Поддерживают принцип "простой, предсказуемый запуск".

7. [DATABASE](./DATABASE.md)  
Практика работы с БД и миграциями (`migratus`). Это обязательный минимум для живого релиза.

8. [HYDRATION](./HYDRATION.md)  
Протокол ленивой гидрации и anti-storm минимум. Нужен для устойчивости межмодульных зависимостей.

9. [LOGGING](./LOGGING.md)  
Правила логирования и диагностики. Помогает принимать решения по фактам, а не по догадкам.

10. [SECURITY](./SECURITY.md)  
Минимальный security baseline для простого API без корпоративной перегрузки.

11. [SAGA](./SAGA.md)  
Продвинутый шаблон для длинных бизнес-процессов. Подключается только когда есть реальная необходимость.
